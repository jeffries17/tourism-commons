<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITO Regional Analysis Dashboard - The Gambia</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #1565c0;
            --secondary: #7b1fa2;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --surface: #f7f9fc;
            --card: #ffffff;
            --border: #e7e7e9;
            --text: #111827;
            --text-muted: #667085;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--surface);
            color: var(--text);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        header {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 16px rgba(21, 101, 192, 0.15);
        }
        
        header h1 { margin-bottom: 10px; font-size: 32px; }
        header p { opacity: 0.9; font-size: 16px; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }
        
        .stat-desc {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .section {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
        }
        
        .section h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--text);
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .table th {
            background: var(--surface);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-muted);
            border-bottom: 2px solid var(--border);
        }
        
        .table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }
        
        .table tr:hover {
            background: var(--surface);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        
        .score-bar {
            background: #eef2f6;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }
        
        .score-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            transition: width 0.3s ease;
        }
        
        .tour-card {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: box-shadow 0.2s;
        }
        
        .tour-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .tour-card h4 {
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .tour-card a {
            color: var(--primary);
            text-decoration: none;
            font-size: 13px;
        }
        
        .tour-card a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåç ITO Regional Analysis Dashboard</h1>
            <p>How International Tour Operators Position The Gambia vs West African Competitors</p>
            <p style="font-size: 14px; margin-top: 10px; opacity: 0.8;">Data Source: 239 tours analyzed across 32 operators from 13 source markets</p>
        </header>

        <!-- Overall Statistics -->
        <div class="stats-grid" id="overallStats"></div>

        <!-- Gambia Performance -->
        <div class="section">
            <h2>üá¨üá≤ The Gambia: Current Market Positioning</h2>
            <div class="grid-2">
                <div>
                    <div id="gambiaStats"></div>
                </div>
                <div>
                    <canvas id="gambiaSectorChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Regional Comparison -->
        <div class="section">
            <h2>üìä Regional Competitive Comparison</h2>
            <div class="chart-container">
                <canvas id="regionalComparisonChart"></canvas>
            </div>
        </div>

        <!-- Sector Heatmap -->
        <div class="section">
            <h2>üé® Creative Sector Positioning by Country</h2>
            <div id="sectorHeatmap"></div>
        </div>

        <!-- Gap Analysis -->
        <div class="section">
            <h2>üéØ Competitive Gaps: Where Competitors Lead</h2>
            <div id="gapAnalysis"></div>
        </div>

        <!-- Packaging Analysis -->
        <div class="section">
            <h2>üîó Multi-Country Packaging Patterns</h2>
            <div class="grid-2">
                <div>
                    <h3 style="font-size: 16px; margin-bottom: 15px;">Gambia Packaging Mix</h3>
                    <canvas id="packagingChart"></canvas>
                </div>
                <div>
                    <h3 style="font-size: 16px; margin-bottom: 15px;">Most Common Combinations</h3>
                    <div id="coOccurrence"></div>
                </div>
            </div>
        </div>

        <!-- Top Tours -->
        <div class="section">
            <h2>‚≠ê Top 10 Tours Globally (Benchmarks)</h2>
            <div id="topTours"></div>
        </div>

        <!-- Top Operators -->
        <div class="section">
            <h2>üèÜ Top Creative Tourism Operators</h2>
            <table class="table" id="operatorTable"></table>
        </div>
    </div>

    <script>
        // Load and visualize data
        fetch('ito_regional_analysis.json')
            .then(response => response.json())
            .then(data => {
                console.log('Data loaded:', data);
                renderDashboard(data);
            })
            .catch(error => {
                console.error('Error loading data:', error);
                document.body.innerHTML = '<div class="loading">‚ùå Error loading data. Make sure ito_regional_analysis.json is in the same directory.</div>';
            });

        function renderDashboard(data) {
            // Overall Stats
            renderOverallStats(data.summary_stats);
            
            // Gambia Analysis
            renderGambiaStats(data.gambia_standalone);
            renderGambiaSectorChart(data.gambia_standalone.sector_averages);
            
            // Regional Comparison
            renderRegionalComparison(data.regional_comparison);
            
            // Sector Heatmap
            renderSectorHeatmap(data.regional_comparison);
            
            // Gap Analysis
            renderGapAnalysis(data.gap_analysis);
            
            // Packaging
            renderPackaging(data.gambia_standalone.packaging, data.packaging_analysis);
            
            // Top Tours
            renderTopTours(data.top_tours_global);
            
            // Operators
            renderOperatorTable(data.operator_insights.top_10_creative);
        }

        function renderOverallStats(stats) {
            const html = `
                <div class="stat-card">
                    <div class="stat-label">Total Tours</div>
                    <div class="stat-value">${stats.total_analyzed}</div>
                    <div class="stat-desc">${stats.tour_pages} itineraries + ${stats.destination_pages} destination pages</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Operators</div>
                    <div class="stat-value">${stats.unique_operators}</div>
                    <div class="stat-desc">From ${stats.source_markets} source markets</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Countries</div>
                    <div class="stat-value">6</div>
                    <div class="stat-desc">Gambia, Senegal, Ghana, Benin, Nigeria, Cape Verde</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Analysis Date</div>
                    <div class="stat-value">${stats.analysis_date}</div>
                    <div class="stat-desc">Latest data snapshot</div>
                </div>
            `;
            document.getElementById('overallStats').innerHTML = html;
        }

        function renderGambiaStats(gambia) {
            const positiveClass = gambia.sentiment_breakdown.positive_pct > 60 ? 'badge-success' : 
                                 gambia.sentiment_breakdown.positive_pct > 40 ? 'badge-warning' : 'badge-danger';
            
            const html = `
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 18px; margin-bottom: 15px;">Key Metrics</h3>
                    <div style="display: grid; gap: 15px;">
                        <div>
                            <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">Creative Tourism Score</div>
                            <div style="font-size: 28px; font-weight: 700; color: var(--danger);">${gambia.avg_creative_score}/100</div>
                            <div class="score-bar">
                                <div class="score-bar-fill" style="width: ${gambia.avg_creative_score}%"></div>
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">Sentiment Score</div>
                            <div style="font-size: 24px; font-weight: 600;">${gambia.avg_sentiment}</div>
                            <span class="${positiveClass} badge">${gambia.sentiment_breakdown.positive_pct}% Positive</span>
                        </div>
                        <div>
                            <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">Packaging</div>
                            <div style="font-size: 18px; font-weight: 600;">${gambia.packaging.pure_pct}% Pure Tours</div>
                            <div style="font-size: 12px; color: var(--text-muted);">${gambia.packaging.pure_count} pure vs ${gambia.packaging.multi_count} multi-country</div>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 style="font-size: 14px; margin-bottom: 10px;">Top Themes</h4>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        ${Object.entries(gambia.top_themes).slice(0, 5).map(([theme, count]) => 
                            `<span class="badge" style="background: var(--surface); color: var(--text);">${theme} (${count})</span>`
                        ).join('')}
                    </div>
                </div>
            `;
            document.getElementById('gambiaStats').innerHTML = html;
        }

        function renderGambiaSectorChart(sectors) {
            const ctx = document.getElementById('gambiaSectorChart').getContext('2d');
            const sectorNames = Object.keys(sectors).map(s => s.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()));
            const sectorValues = Object.values(sectors);
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: sectorNames,
                    datasets: [{
                        label: 'Gambia Sector Scores',
                        data: sectorValues,
                        fill: true,
                        backgroundColor: 'rgba(21, 101, 192, 0.2)',
                        borderColor: 'rgb(21, 101, 192)',
                        pointBackgroundColor: 'rgb(21, 101, 192)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(21, 101, 192)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { stepSize: 2 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function renderRegionalComparison(regional) {
            const ctx = document.getElementById('regionalComparisonChart').getContext('2d');
            const countries = Object.keys(regional);
            const scores = countries.map(c => regional[c].avg_creative_score);
            const sentiments = countries.map(c => regional[c].avg_sentiment * 50); // Scale for visibility
            const tourCounts = countries.map(c => regional[c].tour_count);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: countries,
                    datasets: [
                        {
                            label: 'Creative Tourism Score',
                            data: scores,
                            backgroundColor: 'rgba(21, 101, 192, 0.7)',
                            borderColor: 'rgb(21, 101, 192)',
                            borderWidth: 1
                        },
                        {
                            label: 'Tour Count',
                            data: tourCounts,
                            backgroundColor: 'rgba(123, 31, 162, 0.7)',
                            borderColor: 'rgb(123, 31, 162)',
                            borderWidth: 1,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'Creative Score' }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            title: { display: true, text: 'Tour Count' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        function renderSectorHeatmap(regional) {
            const sectors = ['heritage', 'crafts', 'music', 'performing_arts', 'festivals', 'audiovisual', 'fashion', 'publishing'];
            const countries = Object.keys(regional);
            
            let html = '<table class="table"><thead><tr><th>Sector</th>';
            countries.forEach(c => html += `<th>${c}</th>`);
            html += '</tr></thead><tbody>';
            
            sectors.forEach(sector => {
                html += `<tr><td style="font-weight: 600;">${sector.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</td>`;
                countries.forEach(country => {
                    const score = regional[country].sector_scores[sector];
                    const color = score >= 7 ? '#d4edda' : score >= 4 ? '#fff3cd' : '#f8d7da';
                    const textColor = score >= 7 ? '#155724' : score >= 4 ? '#856404' : '#721c24';
                    html += `<td style="background: ${color}; color: ${textColor}; font-weight: 600; text-align: center;">${score}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            document.getElementById('sectorHeatmap').innerHTML = html;
        }

        function renderGapAnalysis(gaps) {
            let html = '';
            Object.entries(gaps).forEach(([country, data]) => {
                const gapClass = data.overall_gap > 20 ? 'badge-danger' : data.overall_gap > 10 ? 'badge-warning' : 'badge-success';
                html += `
                    <div style="border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="font-size: 16px;">${country}</h4>
                            <span class="badge ${gapClass}">+${data.overall_gap} points</span>
                        </div>
                        <div style="font-size: 13px; color: var(--text-muted);">
                            Biggest gap: <strong>${data.biggest_gap_sector?.replace('_', ' ')}</strong>
                        </div>
                        <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px;">
                            ${Object.entries(data.sector_gaps).filter(([s, v]) => v > 2).map(([sector, gap]) => 
                                `<span class="badge badge-warning">${sector.replace('_', ' ')}: +${gap}</span>`
                            ).join('')}
                        </div>
                    </div>
                `;
            });
            document.getElementById('gapAnalysis').innerHTML = html;
        }

        function renderPackaging(gambiaPackaging, packagingData) {
            const ctx = document.getElementById('packagingChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Pure Gambia Tours', 'Multi-Country Packages'],
                    datasets: [{
                        data: [gambiaPackaging.pure_count, gambiaPackaging.multi_count],
                        backgroundColor: ['rgba(40, 167, 69, 0.7)', 'rgba(255, 193, 7, 0.7)'],
                        borderColor: ['rgb(40, 167, 69)', 'rgb(255, 193, 7)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            
            // Co-occurrence
            if (packagingData.co_occurrence_counts) {
                let html = '<div style="display: grid; gap: 10px;">';
                Object.entries(packagingData.co_occurrence_counts).forEach(([country, count]) => {
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--surface); border-radius: 6px;">
                            <span style="font-weight: 600;">${country}</span>
                            <span class="badge" style="background: var(--primary); color: white;">${count} tours</span>
                        </div>
                    `;
                });
                html += '</div>';
                document.getElementById('coOccurrence').innerHTML = html;
            }
        }

        function renderTopTours(tours) {
            let html = '';
            tours.slice(0, 10).forEach((tour, i) => {
                const rankBadge = i < 3 ? 'badge-success' : i < 7 ? 'badge-warning' : '';
                html += `
                    <div class="tour-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <h4 style="margin: 0;">#${tour.rank} - ${tour.operator}</h4>
                            <span class="badge ${rankBadge}" style="font-size: 14px; font-weight: 700;">${tour.creative_score}/100</span>
                        </div>
                        <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">
                            ${tour.destination} ‚Ä¢ ${tour.page_type} ‚Ä¢ ${tour.is_pure === 'Yes' ? 'Pure' : 'Multi-country'}
                        </div>
                        <a href="${tour.url}" target="_blank">View Tour ‚Üí</a>
                    </div>
                `;
            });
            document.getElementById('topTours').innerHTML = html;
        }

        function renderOperatorTable(operators) {
            let html = '<thead><tr><th>Rank</th><th>Operator</th><th>Source Market</th><th>Tours</th><th>Avg Score</th><th>Countries</th></tr></thead><tbody>';
            Object.entries(operators).forEach(([operator, data], i) => {
                html += `
                    <tr>
                        <td><strong>#${i + 1}</strong></td>
                        <td>${operator}</td>
                        <td>${data.source_country}</td>
                        <td>${data.tour_count}</td>
                        <td><strong>${data.avg_creative_score}/100</strong></td>
                        <td><span class="badge" style="background: var(--surface); color: var(--text);">${data.countries_covered.length} countries</span></td>
                    </tr>
                `;
            });
            html += '</tbody>';
            document.getElementById('operatorTable').innerHTML = html;
        }
    </script>
</body>
</html>

